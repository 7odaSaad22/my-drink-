<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…ØªØ¬Ø± Ø§Ù„Ù…Ø´Ø±ÙˆØ¨Ø§Øª - Ø§Ù„Ø¹Ù…ÙŠÙ„</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <script>
        if (!localStorage.getItem('currentCustomer')) { window.location.href = 'auth/login.html'; }
    </script>
    <header>
        <h1>â˜• Ù…ØªØ¬Ø± Ø§Ù„Ù…Ø´Ø±ÙˆØ¨Ø§Øª</h1>
        <div class="user-info">
            <span id="userNameDisplay"></span>
            <button onclick="localStorage.removeItem('currentCustomer'); window.location.reload();" class="logout-btn">Ø®Ø±ÙˆØ¬</button>
        </div>
    </header>
    <div class="container">
        <div class="orders-layout">
            <div class="products-section">
                <div class="product-grid" id="productGrid"></div>
            </div>
            <div class="order-summary">
                <h3>ðŸ›’ Ø³Ù„Ø© Ø§Ù„Ø·Ù„Ø¨</h3>
                <div id="orderItems"></div>
                <textarea id="orderNotes" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª..." rows="2" style="width:100%; margin-top:10px; padding:8px; border-radius:8px; border:1px solid #ddd;"></textarea>
                <div style="margin-top:10px; text-align:center;"><strong>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: <span id="totalItems">0</span></strong></div>
                <button onclick="submitOrder()" class="submit-btn">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨</button>
            </div>
        </div>
        <div class="orders-tracking">
            <h3>ðŸ“¦ Ø·Ù„Ø¨Ø§ØªÙŠ Ø§Ù„Ø£Ø®ÙŠØ±Ø©</h3>
            <div id="history"></div>
        </div>
    </div>
    <script>
        // Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙƒØ§Ù…Ù„Ø© (20 Ù…Ù†ØªØ¬) Ù„Ø¶Ù…Ø§Ù† Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ù…Ø¹ Ø§Ù„Ø¥Ø¯Ù…Ù†
        const products = ['Ø´Ø§ÙŠ', 'Ø´Ø§ÙŠ Ø£Ø®Ø¶Ø±', 'ÙŠØ§Ù†Ø³ÙˆÙ†', 'Ù†Ø¹Ù†Ø§Ø¹', 'ÙƒØ±ÙƒØ¯ÙŠØ©', 'Ù‚Ø±ÙØ©', 'Ø¬Ù†Ø²Ø¨ÙŠÙ„', 'ÙƒÙˆÙÙŠ Ù…ÙŠÙƒØ³', 'ÙƒÙˆÙÙŠ Ù…ÙŠÙƒØ³ 4*1', 'Ù†Ø³ÙƒØ§ÙÙŠÙ‡3*1', 'Ù†Ø³ÙƒØ§ÙÙŠÙ‡ 2*1', 'Ù†Ø³ÙƒØ§ÙÙŠÙ‡ Ø¨Ù„Ø§Ùƒ', 'ÙƒØ§Ø¨ØªØ´ÙŠÙ†Ùˆ Ø¨Ù†Ø¯Ù‚', 'ÙƒØ§Ø¨ØªØ´ÙŠÙ†Ùˆ Ù…ÙˆÙƒØ§', 'ÙƒØ§Ø¨ØªØ´ÙŠÙ†Ùˆ Ù„Ø§ØªÙŠÙ‡', 'Ù‡ÙˆØª Ø´ÙˆÙƒÙ„Øª', 'Ù‚Ù‡ÙˆØ© ØªØ±ÙƒÙŠ', 'Ù‚Ù‡ÙˆØ© ÙØ±Ù†Ø³Ø§ÙˆÙŠ', 'Ù‚Ø±ÙØ© Ø¨Ø­Ù„ÙŠØ¨', 'Ø´Ø§ÙŠ Ø¨Ø­Ù„ÙŠØ¨'];
        let cart = [];

        function render() {
            const grid = document.getElementById('productGrid');
            const inv = JSON.parse(localStorage.getItem('inventory')) || {};
            grid.innerHTML = '';
            products.forEach((p, i) => {
                const stock = inv[p] ? inv[p].stock : 50;
                grid.innerHTML += `
                <div class="card ${stock <= 0 ? 'out-of-stock' : ''}">
                    <h3>${p}</h3>
                    <div class="quantity-selector">
                        <button onclick="changeQty(${i},-1)">-</button>
                        <input type="number" id="qty${i}" value="0" readonly>
                        <button onclick="changeQty(${i},1)">+</button>
                    </div>
                    <button onclick="add(${i},'${p}')" class="add-btn" ${stock <= 0 ? 'disabled' : ''}>
                        ${stock <= 0 ? 'Ù†ÙØ°' : 'Ø¥Ø¶Ø§ÙØ©'}
                    </button>
                </div>`;
            });
        }
        function changeQty(i,a) { const el = document.getElementById('qty'+i); el.value = Math.max(0, parseInt(el.value)+a); }
        function add(i,p) {
            const q = parseInt(document.getElementById('qty'+i).value);
            if(q<=0) return;
            const item = cart.find(c=>c.name===p);
            if(item) item.qty += q; else cart.push({name:p, qty:q});
            document.getElementById('qty'+i).value = 0;
            updateCart();
        }
        function updateCart() {
            const container = document.getElementById('orderItems');
            container.innerHTML = cart.map((c,i)=>`<div class="order-item"><span>${c.name} (${c.qty})</span><button onclick="cart.splice(${i},1);updateCart();" style="color:red; background:none; border:none; cursor:pointer;">âœ•</button></div>`).join('');
            document.getElementById('totalItems').textContent = cart.reduce((s,c)=>s+c.qty, 0);
        }
        function submitOrder() {
            if(cart.length===0) return;
            const orders = JSON.parse(localStorage.getItem('orders')) || [];
            orders.push({ id: Date.now(), customerName: localStorage.getItem('currentCustomer'), items: cart, status: 'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©', date: new Date().toLocaleTimeString('ar-EG') });
            localStorage.setItem('orders', JSON.stringify(orders));
            cart = []; updateCart(); loadHistory(); alert('ØªÙ… Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­!');
        }
        function loadHistory() {
            const my = (JSON.parse(localStorage.getItem('orders')) || []).filter(o=>o.customerName === localStorage.getItem('currentCustomer'));
            document.getElementById('history').innerHTML = my.reverse().map(o=>`<div class="order-card ${o.status==='Ù…ÙˆØ§ÙÙ‚ Ø¹Ù„ÙŠÙ‡'?'approved':''}"><strong>Ø·Ù„Ø¨ #${o.id.toString().slice(-4)}</strong> - ${o.status}</div>`).join('');
        }
        window.onload = () => { document.getElementById('userNameDisplay').textContent = localStorage.getItem('currentCustomer'); render(); loadHistory(); };
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ù…Ù†</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <script>
        if (!localStorage.getItem('adminUser')) { window.location.href = 'auth/login.html'; }
    </script>
    <header>
        <h1>ğŸ“Š Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h1>
        <button onclick="localStorage.removeItem('adminUser'); window.location.href='auth/login.html';" class="logout-btn">Ø®Ø±ÙˆØ¬</button>
    </header>
    <div class="container">
        <div class="tabs">
            <button onclick="switchTab('orders')" class="tab-btn active">ğŸ“‹ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</button>
            <button onclick="switchTab('inventory')" class="tab-btn">ğŸ“¦ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</button>
            <button onclick="switchTab('reports')" class="tab-btn">ğŸ“ˆ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</button>
        </div>
        <div id="ordersTab" class="tab-content">
            <div class="orders-table-container">
                <table class="admin-table">
                    <thead><tr><th>Ø§Ù„Ø¹Ù…ÙŠÙ„</th><th>Ø§Ù„Ø·Ù„Ø¨</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th><th>Ø¥Ø¬Ø±Ø§Ø¡</th></tr></thead>
                    <tbody id="ordersBody"></tbody>
                </table>
            </div>
        </div>
        <div id="inventoryTab" class="tab-content" style="display:none;">
            <div class="product-grid" id="invGrid"></div>
        </div>
        <div id="reportsTab" class="tab-content" style="display:none;">
            <div id="repBody"></div>
        </div>
    </div>
    <script>
        const allProducts = ['Ø´Ø§ÙŠ', 'Ø´Ø§ÙŠ Ø£Ø®Ø¶Ø±', 'ÙŠØ§Ù†Ø³ÙˆÙ†', 'Ù†Ø¹Ù†Ø§Ø¹', 'ÙƒØ±ÙƒØ¯ÙŠØ©', 'Ù‚Ø±ÙØ©', 'Ø¬Ù†Ø²Ø¨ÙŠÙ„', 'ÙƒÙˆÙÙŠ Ù…ÙŠÙƒØ³', 'ÙƒÙˆÙÙŠ Ù…ÙŠÙƒØ³ 4*1', 'Ù†Ø³ÙƒØ§ÙÙŠÙ‡3*1', 'Ù†Ø³ÙƒØ§ÙÙŠÙ‡ 2*1', 'Ù†Ø³ÙƒØ§ÙÙŠÙ‡ Ø¨Ù„Ø§Ùƒ', 'ÙƒØ§Ø¨ØªØ´ÙŠÙ†Ùˆ Ø¨Ù†Ø¯Ù‚', 'ÙƒØ§Ø¨ØªØ´ÙŠÙ†Ùˆ Ù…ÙˆÙƒØ§', 'ÙƒØ§Ø¨ØªØ´ÙŠÙ†Ùˆ Ù„Ø§ØªÙŠÙ‡', 'Ù‡ÙˆØª Ø´ÙˆÙƒÙ„Øª', 'Ù‚Ù‡ÙˆØ© ØªØ±ÙƒÙŠ', 'Ù‚Ù‡ÙˆØ© ÙØ±Ù†Ø³Ø§ÙˆÙŠ', 'Ù‚Ø±ÙØ© Ø¨Ø­Ù„ÙŠØ¨', 'Ø´Ø§ÙŠ Ø¨Ø­Ù„ÙŠØ¨'];
        
        function switchTab(t) {
            document.querySelectorAll('.tab-content').forEach(e=>e.style.display='none');
            document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
            document.getElementById(t+'Tab').style.display='block';
            event.currentTarget.classList.add('active');
            if(t==='reports') genRep();
            if(t==='inventory') renderInv();
            if(t==='orders') loadOrders();
        }
        function loadOrders() {
            const orders = JSON.parse(localStorage.getItem('orders')) || [];
            document.getElementById('ordersBody').innerHTML = orders.slice().reverse().map((o,i)=> {
                const originalIndex = orders.length - 1 - i;
                return `
                <tr>
                    <td>${o.customerName}</td>
                    <td>${o.items.map(it => it.name + '(' + it.qty + ')').join(', ')}</td>
                    <td><span class="status ${o.status === 'Ù…ÙˆØ§ÙÙ‚ Ø¹Ù„ÙŠÙ‡' ? 'approved' : 'pending'}">${o.status}</span></td>
                    <td>${o.status==='Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©'?`<button onclick="approve(${originalIndex})" style="background:#27ae60; color:white; border:none; padding:5px 10px; border-radius:5px; cursor:pointer;">Ù…ÙˆØ§ÙÙ‚Ø©</button>`:'âœ…'}</td>
                </tr>`}).join('');
        }
        function approve(i) {
            let orders = JSON.parse(localStorage.getItem('orders'));
            let inv = JSON.parse(localStorage.getItem('inventory')) || {};
            
            // Ø®ØµÙ… Ø§Ù„ÙƒÙ…ÙŠØ© Ù…Ù† Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø¹Ù†Ø¯ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©
            orders[i].items.forEach(item => {
                if (!inv[item.name]) inv[item.name] = { stock: 50 };
                inv[item.name].stock = Math.max(0, inv[item.name].stock - item.qty);
            });
            
            orders[i].status = 'Ù…ÙˆØ§ÙÙ‚ Ø¹Ù„ÙŠÙ‡';
            localStorage.setItem('orders', JSON.stringify(orders));
            localStorage.setItem('inventory', JSON.stringify(inv));
            loadOrders();
            alert('ØªÙ… Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© ÙˆØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø®Ø²ÙˆÙ†');
        }
        function renderInv() {
            const inv = JSON.parse(localStorage.getItem('inventory')) || {};
            document.getElementById('invGrid').innerHTML = allProducts.map(p=>`
                <div class="card">
                    <h3>${p}</h3>
                    <input type="number" value="${inv[p]?inv[p].stock:50}" onchange="updateStock('${p}',this.value)" style="width:80%; text-align:center; padding:5px; border-radius:8px; border:1px solid #ddd;">
                </div>`).join('');
        }
        function updateStock(p,v) {
            let inv = JSON.parse(localStorage.getItem('inventory')) || {};
            inv[p] = {stock: parseInt(v)};
            localStorage.setItem('inventory', JSON.stringify(inv));
        }
        function genRep() {
            const orders = (JSON.parse(localStorage.getItem('orders')) || []).filter(o=>o.status==='Ù…ÙˆØ§ÙÙ‚ Ø¹Ù„ÙŠÙ‡');
            let stats = {}; let total = 0;
            orders.forEach(o=>o.items.forEach(it=>{ total+=it.qty; stats[it.name] = (stats[it.name]||0)+it.qty; }));
            document.getElementById('repBody').innerHTML = `
                <div class="report-grid">
                    <div class="stat-card blue"><h4>Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h4><div class="value">${orders.length}</div></div>
                    <div class="stat-card green"><h4>Ø§Ù„Ø£ÙƒÙˆØ§Ø¨</h4><div class="value">${total}</div></div>
                </div>
                <div class="best-selling">
                    <h3 style="font-size:15px;margin-bottom:10px;">ğŸ”¥ Ø§Ù„Ø£ÙƒØ«Ø± Ù…Ø¨ÙŠØ¹Ø§Ù‹</h3>
                    ${Object.entries(stats).sort((a,b)=>b[1]-a[1]).map(([n,q])=>`<div class="best-item"><span>${n}</span><strong>${q} ÙƒÙˆØ¨</strong></div>`).join('')}
                </div>`;
        }
        window.onload = loadOrders;
    </script>
</body>
</html>